<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GeoWatch India Â· Geopolitical Trade Risk Intelligence</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@400;500;600;700&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet"/>
<style>
:root {
  --bg0: #030608;
  --bg1: #070c14;
  --bg2: #0b1220;
  --bg3: #101928;
  --border: rgba(255,255,255,0.06);
  --border-accent: rgba(0,212,255,0.2);
  --accent: #00d4ff;
  --accent2: #ff6b35;
  --accent3: #39ff14;
  --text: #e2e8f0;
  --text-dim: #64748b;
  --text-mid: #94a3b8;
  --crit: #ef4444;
  --high: #f97316;
  --med: #eab308;
  --low: #22c55e;
  --font-mono: 'Share Tech Mono', monospace;
  --font-ui: 'Exo 2', sans-serif;
  --font-display: 'Rajdhani', sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:var(--bg0);color:var(--text);font-family:var(--font-ui);overflow-x:hidden}
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:var(--bg1)}
::-webkit-scrollbar-thumb{background:#1e3a5f;border-radius:2px}

/* --- SCAN LINES --- */
body::before{
  content:'';position:fixed;inset:0;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,212,255,0.015) 2px,rgba(0,212,255,0.015) 4px);
  pointer-events:none;z-index:999;
}

/* --- ANIMATIONS --- */
@keyframes ping{75%,100%{transform:scale(2.5);opacity:0}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes slideInRight{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes fadeUp{from{transform:translateY(12px);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes glow{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 20px var(--accent),0 0 40px rgba(0,212,255,0.3)}}
@keyframes ticker{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
@keyframes radarSpin{to{transform:rotate(360deg)}}
@keyframes ratingFlash{0%{background:rgba(0,212,255,0.3)}100%{background:transparent}}
@keyframes countUp{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
@keyframes borderFlow{0%{border-color:rgba(0,212,255,0.1)}50%{border-color:rgba(0,212,255,0.4)}100%{border-color:rgba(0,212,255,0.1)}}

/* === LAYOUT === */
#app{display:flex;flex-direction:column;height:100vh;overflow:hidden}

/* === HEADER === */
header{
  background:var(--bg1);
  border-bottom:1px solid var(--border-accent);
  padding:0 20px;height:56px;
  display:flex;align-items:center;justify-content:space-between;
  flex-shrink:0;position:relative;
  box-shadow:0 1px 30px rgba(0,212,255,0.08);
}
header::after{
  content:'';position:absolute;bottom:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,var(--accent),transparent);
  opacity:.4;
}
.logo{display:flex;align-items:center;gap:12px}
.logo-icon{
  width:34px;height:34px;border-radius:8px;
  background:linear-gradient(135deg,#FF6B35,#FF9A3C);
  display:flex;align-items:center;justify-content:center;font-size:18px;
  box-shadow:0 0 15px rgba(255,107,53,0.4);
}
.logo-text{font-family:var(--font-display);font-size:16px;font-weight:700;color:#fff;letter-spacing:1px}
.logo-sub{font-family:var(--font-mono);font-size:8px;color:var(--text-dim);letter-spacing:2px;margin-top:1px}
.header-center{display:flex;align-items:center;gap:8px}
.live-badge{display:flex;align-items:center;gap:6px;padding:4px 10px;border-radius:4px;background:rgba(57,255,20,0.08);border:1px solid rgba(57,255,20,0.2)}
.live-dot-wrap{position:relative;width:8px;height:8px}
.live-dot-wrap span:first-child{position:absolute;inset:0;border-radius:50%;background:var(--accent3);animation:ping 1.4s infinite;opacity:.7}
.live-dot-wrap span:last-child{position:absolute;inset:0;border-radius:50%;background:var(--accent3);display:block}
.live-text{font-family:var(--font-mono);font-size:10px;color:var(--accent3);font-weight:600;letter-spacing:1px}
.national-risk-pill{
  display:flex;align-items:center;gap:8px;
  padding:5px 14px;border-radius:6px;
  border:1px solid;font-family:var(--font-mono);font-size:11px;font-weight:700;letter-spacing:1px;
  transition:all .4s;
}
.header-right{display:flex;align-items:center;gap:12px}
.time-display{font-family:var(--font-mono);font-size:12px;color:var(--text-dim)}
#ai-btn{
  background:linear-gradient(135deg,rgba(0,212,255,0.1),rgba(0,212,255,0.05));
  border:1px solid rgba(0,212,255,0.3);border-radius:6px;
  color:var(--accent);font-family:var(--font-mono);font-size:10px;
  padding:6px 14px;cursor:pointer;letter-spacing:1px;
  transition:all .2s;
}
#ai-btn:hover{background:rgba(0,212,255,0.15);box-shadow:0 0 15px rgba(0,212,255,0.2)}

/* === TICKER === */
.ticker-bar{
  background:rgba(0,212,255,0.05);
  border-bottom:1px solid var(--border);
  height:28px;overflow:hidden;display:flex;align-items:center;flex-shrink:0;
}
.ticker-label{
  background:var(--accent);color:#000;
  font-family:var(--font-mono);font-size:9px;font-weight:700;letter-spacing:2px;
  padding:0 12px;height:100%;display:flex;align-items:center;flex-shrink:0;
}
.ticker-inner{overflow:hidden;flex:1}
.ticker-track{display:inline-flex;gap:0;white-space:nowrap;animation:ticker 40s linear infinite}
.ticker-item{
  font-family:var(--font-mono);font-size:10px;
  padding:0 28px;border-right:1px solid var(--border);
  display:inline-flex;align-items:center;gap:6px;
}
.t-crit{color:var(--crit)} .t-high{color:var(--high)} .t-med{color:var(--med)} .t-low{color:var(--low)}

/* === KPI BAR === */
.kpi-bar{
  display:flex;border-bottom:1px solid var(--border);
  flex-shrink:0;background:var(--bg1);overflow-x:auto;
}
.kpi-item{
  padding:10px 20px;border-right:1px solid var(--border);
  min-width:150px;flex-shrink:0;
}
.kpi-label{font-family:var(--font-mono);font-size:8px;color:var(--text-dim);letter-spacing:2px;text-transform:uppercase;margin-bottom:3px}
.kpi-val{font-family:var(--font-mono);font-size:20px;font-weight:700;color:#fff;letter-spacing:-0.5px}
.kpi-sub{display:flex;gap:8px;align-items:center;margin-top:2px}
.kpi-desc{font-size:9px;color:var(--text-dim)}
.kpi-delta{font-family:var(--font-mono);font-size:9px;font-weight:700}
.kpi-delta.up{color:var(--crit)} .kpi-delta.dn{color:var(--low)} .kpi-delta.neu{color:var(--accent)}

/* === MAIN GRID === */
.main-grid{display:grid;grid-template-columns:1fr 1fr 320px;flex:1;overflow:hidden;gap:0}
.panel{overflow-y:auto;border-right:1px solid var(--border)}
.panel:last-child{border-right:none}
.panel-header{
  position:sticky;top:0;z-index:10;
  background:var(--bg2);border-bottom:1px solid var(--border);
  padding:10px 16px;
  font-family:var(--font-mono);font-size:9px;letter-spacing:2px;
  color:var(--accent);text-transform:uppercase;
  display:flex;align-items:center;justify-content:space-between;
}
.panel-body{padding:14px}

/* === SIGNAL FEED === */
.signal-card{
  background:rgba(255,255,255,0.02);
  border:1px solid var(--border);border-radius:8px;
  padding:12px;margin-bottom:8px;
  transition:all .2s;border-left:3px solid;
  cursor:default;
}
.signal-card:hover{background:rgba(255,255,255,0.04);transform:translateX(2px)}
.signal-card.crit{border-left-color:var(--crit)}
.signal-card.high{border-left-color:var(--high)}
.signal-card.med{border-left-color:var(--med)}
.signal-card.low{border-left-color:var(--low)}
.signal-card.new-signal{animation:fadeUp .4s ease}
.sig-meta{display:flex;gap:6px;align-items:center;margin-bottom:6px;flex-wrap:wrap}
.sig-type{font-family:var(--font-mono);font-size:9px;color:var(--text-dim);border:1px solid var(--border);padding:1px 5px;border-radius:3px}
.sig-source{font-family:var(--font-mono);font-size:9px;color:var(--accent)}
.sig-sector{font-size:9px;color:var(--text-mid)}
.sig-text{font-size:12px;color:var(--text);line-height:1.5}
.sig-footer{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.badge{
  padding:2px 7px;border-radius:3px;font-family:var(--font-mono);
  font-size:9px;font-weight:700;letter-spacing:1px;border:1px solid;
}
.badge.crit{background:rgba(239,68,68,.12);border-color:var(--crit);color:#fca5a5}
.badge.high{background:rgba(249,115,22,.12);border-color:var(--high);color:#fdba74}
.badge.med{background:rgba(234,179,8,.12);border-color:var(--med);color:#fde047}
.badge.low{background:rgba(34,197,94,.12);border-color:var(--low);color:#86efac}
.sig-time{font-family:var(--font-mono);font-size:9px;color:var(--text-dim)}
.trend-up{color:var(--crit);font-size:11px} .trend-dn{color:var(--low);font-size:11px} .trend-neu{color:var(--text-dim);font-size:11px}

/* filter bar */
.filter-bar{display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap}
.filter-btn{
  padding:3px 10px;border-radius:4px;font-family:var(--font-mono);font-size:9px;
  font-weight:700;letter-spacing:1px;border:1px solid var(--border);
  background:transparent;color:var(--text-dim);cursor:pointer;transition:all .15s;
}
.filter-btn.active-all{background:rgba(0,212,255,.1);border-color:var(--accent);color:var(--accent)}
.filter-btn.active-CRITICAL{background:rgba(239,68,68,.1);border-color:var(--crit);color:#fca5a5}
.filter-btn.active-HIGH{background:rgba(249,115,22,.1);border-color:var(--high);color:#fdba74}
.filter-btn.active-MEDIUM{background:rgba(234,179,8,.1);border-color:var(--med);color:#fde047}
.filter-btn.active-LOW{background:rgba(34,197,94,.1);border-color:var(--low);color:#86efac}

/* === PARTNER RATINGS PANEL === */
.partner-card{
  background:var(--bg2);border:1px solid var(--border);
  border-radius:10px;padding:14px;margin-bottom:10px;
  transition:all .3s;position:relative;overflow:hidden;
  animation:borderFlow 4s infinite;
}
.partner-card::before{
  content:'';position:absolute;top:0;right:0;
  width:60px;height:60px;border-radius:50%;
  filter:blur(30px);opacity:.15;pointer-events:none;
}
.partner-card.partner-us::before{background:#3b82f6}
.partner-card.partner-eu::before{background:#22c55e}
.partner-card.partner-ru::before{background:#ef4444}
.partner-card.partner-cn::before{background:#f59e0b}
.partner-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}
.partner-name{display:flex;align-items:center;gap:8px}
.partner-flag{font-size:20px}
.partner-title{font-family:var(--font-display);font-size:15px;font-weight:700;color:#fff}
.partner-subtitle{font-family:var(--font-mono);font-size:9px;color:var(--text-dim);margin-top:1px}
.partner-rating-box{text-align:right}
.rating-score{
  font-family:var(--font-mono);font-size:28px;font-weight:700;
  line-height:1;transition:all .4s;
}
.rating-label{font-family:var(--font-mono);font-size:8px;letter-spacing:1px;margin-top:2px}
.rating-change{font-family:var(--font-mono);font-size:10px;font-weight:700;margin-top:2px}
.partner-bar-wrap{margin:8px 0}
.partner-bar-label{display:flex;justify-content:space-between;margin-bottom:4px}
.bar-lbl{font-family:var(--font-mono);font-size:8px;color:var(--text-dim);letter-spacing:1px}
.bar-track{height:6px;background:rgba(255,255,255,0.07);border-radius:3px;overflow:hidden}
.bar-fill{height:100%;border-radius:3px;transition:width .8s cubic-bezier(.4,0,.2,1)}
.partner-tags{display:flex;gap:5px;flex-wrap:wrap;margin-top:8px}
.ptag{font-family:var(--font-mono);font-size:8px;padding:2px 7px;border-radius:3px;border:1px solid;background:rgba(255,255,255,0.04)}
.partner-note{font-size:11px;color:var(--text-mid);margin-top:6px;line-height:1.5;font-style:italic}
.live-update-flash{animation:ratingFlash .6s ease;border-radius:4px}

/* === SIDEBAR === */
.sidebar-section{margin-bottom:18px}
.section-label{font-family:var(--font-mono);font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--accent);margin-bottom:10px;padding-bottom:4px;border-bottom:1px solid rgba(0,212,255,0.15)}

/* predictions */
.pred-card{
  background:rgba(255,255,255,0.02);border:1px solid var(--border);
  border-radius:8px;padding:10px;margin-bottom:8px;
}
.pred-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.pred-type{font-family:var(--font-mono);font-size:8px;color:var(--text-dim)}
.pred-prob{font-family:var(--font-mono);font-size:16px;font-weight:700}
.pred-text{font-size:11px;color:var(--text-mid);line-height:1.4;margin-bottom:6px}
.pred-bar-track{height:3px;background:rgba(255,255,255,0.07);border-radius:2px}
.pred-bar-fill{height:100%;border-radius:2px;transition:width 1s ease}

/* energy bars */
.energy-row{margin-bottom:10px}
.energy-top{display:flex;justify-content:space-between;margin-bottom:4px}
.energy-name{font-size:11px;color:var(--text)}
.energy-pct{font-family:var(--font-mono);font-size:11px}
.energy-track{height:5px;background:rgba(255,255,255,0.06);border-radius:3px;overflow:hidden}
.energy-fill{height:100%;border-radius:3px;transition:width 1s ease;position:relative}
.energy-fill::after{content:'';position:absolute;right:0;top:0;bottom:0;width:3px;filter:blur(3px)}

/* sector rings */
.sector-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.sector-card{
  background:rgba(255,255,255,0.02);border:1px solid var(--border);
  border-radius:8px;padding:10px;text-align:center;
}
.sector-name{font-size:10px;color:var(--text-mid);margin-bottom:6px}
.sector-ring{position:relative;width:54px;height:54px;margin:0 auto 6px}
.ring-svg{transform:rotate(-90deg)}
.ring-bg{fill:none;stroke:rgba(255,255,255,0.07);stroke-width:4}
.ring-fill{fill:none;stroke-width:4;stroke-linecap:round;transition:stroke-dashoffset 1s ease}
.ring-val{
  position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  font-family:var(--font-mono);font-size:11px;font-weight:700;
}
.sector-risk{font-family:var(--font-mono);font-size:8px;letter-spacing:1px}

/* AI modal */
#ai-modal{
  position:fixed;inset:0;background:rgba(0,0,0,0.88);
  backdrop-filter:blur(10px);z-index:200;
  display:none;align-items:center;justify-content:center;padding:24px;
}
#ai-modal.open{display:flex}
.modal-box{
  background:var(--bg1);border:1px solid rgba(0,212,255,0.25);
  border-radius:12px;width:100%;max-width:700px;max-height:82vh;
  overflow:hidden;display:flex;flex-direction:column;
  box-shadow:0 0 80px rgba(0,212,255,0.1);
}
.modal-header{
  background:rgba(0,212,255,0.05);
  border-bottom:1px solid rgba(0,212,255,0.15);
  padding:14px 20px;display:flex;justify-content:space-between;align-items:center;
}
.modal-title{font-family:var(--font-mono);font-size:12px;color:var(--accent);letter-spacing:1px}
.modal-meta{font-family:var(--font-mono);font-size:9px;color:var(--text-dim);margin-top:2px}
#modal-close{
  background:rgba(255,255,255,0.06);border:none;color:var(--text-dim);
  width:28px;height:28px;border-radius:6px;cursor:pointer;font-size:14px;
}
#modal-close:hover{background:rgba(255,255,255,0.12);color:#fff}
.modal-body{flex:1;overflow-y:auto;padding:24px}
#ai-output{font-family:var(--font-mono);font-size:12px;line-height:1.9;color:#d1d5db;white-space:pre-wrap}
.loading-state{text-align:center;padding:40px}
.spinner{font-size:28px;display:inline-block;animation:spin 1s linear infinite;color:var(--accent)}
.loading-text{font-family:var(--font-mono);font-size:12px;color:var(--accent);margin-top:12px}
.loading-sub{font-family:var(--font-mono);font-size:9px;color:var(--text-dim);margin-top:4px}

/* toast */
#toast{
  position:fixed;top:70px;right:16px;z-index:300;
  max-width:340px;display:none;
  animation:slideInRight .4s ease;
}
#toast.show{display:block}
.toast-inner{
  background:var(--bg1);border:1px solid;border-radius:10px;
  padding:12px 16px;box-shadow:0 4px 30px rgba(0,0,0,0.5);
}
.toast-top{display:flex;gap:8px;align-items:center;margin-bottom:5px}
.toast-label{font-family:var(--font-mono);font-size:9px;font-weight:700;letter-spacing:1px}
.toast-text{font-size:11px;color:var(--text-mid);line-height:1.4}

/* responsive */
@media(max-width:900px){
  .main-grid{grid-template-columns:1fr;height:auto}
  .panel{overflow-y:visible;max-height:none}
  #app{overflow:auto}
  .kpi-bar{flex-wrap:wrap}
}
</style>
</head>
<body>
<div id="app">

<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-icon">ðŸ‡®ðŸ‡³</div>
    <div>
      <div class="logo-text">GEOWATCH INDIA</div>
      <div class="logo-sub">MINISTRY OF COMMERCE Â· TRADE RISK INTELLIGENCE PLATFORM</div>
    </div>
  </div>
  <div class="header-center">
    <div class="live-badge">
      <div class="live-dot-wrap"><span></span><span></span></div>
      <span class="live-text">LIVE</span>
    </div>
    <div class="national-risk-pill" id="nat-risk-pill">
      <div class="live-dot-wrap" id="nat-dot"><span></span><span></span></div>
      <span id="nat-risk-text">NATIONAL RISK: â€”</span>
    </div>
  </div>
  <div class="header-right">
    <div class="time-display" id="clock">00:00:00 IST</div>
    <button id="ai-btn">â—ˆ AI BRIEFING</button>
  </div>
</header>

<!-- TICKER -->
<div class="ticker-bar">
  <div class="ticker-label">â–¶ LIVE FEED</div>
  <div class="ticker-inner">
    <div class="ticker-track" id="ticker-track"></div>
  </div>
</div>

<!-- KPI BAR -->
<div class="kpi-bar">
  <div class="kpi-item">
    <div class="kpi-label">Merchandise Deficit</div>
    <div class="kpi-val">$34.68B</div>
    <div class="kpi-sub"><span class="kpi-desc">Jan 2026</span><span class="kpi-delta up">â–² +47.9% YoY</span></div>
  </div>
  <div class="kpi-item">
    <div class="kpi-label">Russia Energy Share</div>
    <div class="kpi-val" id="kpi-russia">38%</div>
    <div class="kpi-sub"><span class="kpi-desc">of crude imports</span><span class="kpi-delta up">â–² +3.2pp</span></div>
  </div>
  <div class="kpi-item">
    <div class="kpi-label">US Tariff Exposure</div>
    <div class="kpi-val">$13.2B</div>
    <div class="kpi-sub"><span class="kpi-desc">affected exports</span><span class="kpi-delta up">âš  Under Review</span></div>
  </div>
  <div class="kpi-item">
    <div class="kpi-label">India-EU FTA</div>
    <div class="kpi-val">â‚¬180B</div>
    <div class="kpi-sub"><span class="kpi-desc">annual coverage</span><span class="kpi-delta dn">âœ“ Active</span></div>
  </div>
  <div class="kpi-item">
    <div class="kpi-label">Active Risk Signals</div>
    <div class="kpi-val" id="kpi-signals">7</div>
    <div class="kpi-sub"><span class="kpi-desc">last 24h</span><span class="kpi-delta up" id="kpi-crit-count">2 CRITICAL</span></div>
  </div>
  <div class="kpi-item">
    <div class="kpi-label">Bilateral (Russia)</div>
    <div class="kpi-val">$68.7B</div>
    <div class="kpi-sub"><span class="kpi-desc">FY2025</span><span class="kpi-delta up">â–² +18.4% YoY</span></div>
  </div>
  <div class="kpi-item" style="border-right:none">
    <div class="kpi-label">System Status</div>
    <div class="kpi-val" style="color:var(--low)">99.8%</div>
    <div class="kpi-sub"><span class="kpi-desc">Uptime SLA</span><span class="kpi-delta dn">âœ“ Operational</span></div>
  </div>
</div>

<!-- MAIN GRID -->
<div class="main-grid">

  <!-- PANEL 1: SIGNAL FEED -->
  <div class="panel">
    <div class="panel-header">
      <span>âš¡ LIVE RISK SIGNAL FEED</span>
      <span id="signal-count" style="color:var(--text-dim)">0 signals</span>
    </div>
    <div class="panel-body">
      <div class="filter-bar" id="filter-bar">
        <button class="filter-btn active-all" data-filter="ALL" onclick="setFilter('ALL')">ALL</button>
        <button class="filter-btn" data-filter="CRITICAL" onclick="setFilter('CRITICAL')">CRITICAL</button>
        <button class="filter-btn" data-filter="HIGH" onclick="setFilter('HIGH')">HIGH</button>
        <button class="filter-btn" data-filter="MEDIUM" onclick="setFilter('MEDIUM')">MEDIUM</button>
        <button class="filter-btn" data-filter="LOW" onclick="setFilter('LOW')">LOW</button>
      </div>
      <div id="signal-feed"></div>
    </div>
  </div>

  <!-- PANEL 2: PARTNER RATINGS -->
  <div class="panel">
    <div class="panel-header">
      <span>â—‰ LIVE PARTNER RISK RATINGS</span>
      <span style="color:var(--text-dim);font-size:8px">UPDATES EVERY 8s</span>
    </div>
    <div class="panel-body">
      <div id="partner-ratings"></div>

      <div style="margin-top:16px">
        <div class="section-label">â›½ ENERGY DEPENDENCY MATRIX</div>
        <div id="energy-bars"></div>
      </div>

      <div style="margin-top:16px">
        <div class="section-label">ðŸ“¦ SECTOR VULNERABILITY</div>
        <div class="sector-grid" id="sector-grid"></div>
      </div>
    </div>
  </div>

  <!-- PANEL 3: SIDEBAR -->
  <div class="panel">
    <div class="panel-header">
      <span>ðŸ”® PREDICTIVE ANALYTICS</span>
    </div>
    <div class="panel-body">
      <div class="sidebar-section">
        <div class="section-label">30-DAY RISK FORECAST</div>
        <div id="predictions"></div>
      </div>

      <div class="sidebar-section">
        <div class="section-label">EXPORT DIVERSION MAP</div>
        <div id="export-map"></div>
      </div>

      <div class="sidebar-section">
        <div class="section-label">RECOMMENDED SAFEGUARDS</div>
        <div id="safeguards"></div>
      </div>

      <button id="ai-btn-2" onclick="openAI()" style="
        width:100%;background:linear-gradient(135deg,rgba(0,212,255,0.08),rgba(0,212,255,0.03));
        border:1px solid rgba(0,212,255,0.2);border-radius:10px;padding:14px;cursor:pointer;text-align:left;
        transition:all .2s;
      ">
        <div style="font-family:var(--font-mono);font-size:9px;color:var(--accent);letter-spacing:1px;margin-bottom:5px">â—ˆ AI INTELLIGENCE ENGINE Â· CLAUDE</div>
        <div style="font-size:11px;color:#93c5fd;line-height:1.5;margin-bottom:10px">Get real-time AI analysis synthesizing all active signals into a classified intelligence briefing.</div>
        <div style="background:rgba(0,212,255,0.1);border:1px solid rgba(0,212,255,0.2);border-radius:6px;padding:6px;font-family:var(--font-mono);font-size:10px;color:var(--accent);text-align:center">
          GENERATE BRIEFING â†’
        </div>
      </button>
    </div>
  </div>
</div>
</div>

<!-- TOAST -->
<div id="toast">
  <div class="toast-inner" id="toast-inner">
    <div class="toast-top">
      <div class="live-dot-wrap"><span></span><span></span></div>
      <span class="toast-label" id="toast-label">LIVE SIGNAL</span>
    </div>
    <div class="toast-text" id="toast-text"></div>
  </div>
</div>

<!-- AI MODAL -->
<div id="ai-modal">
  <div class="modal-box">
    <div class="modal-header">
      <div>
        <div class="modal-title">â—ˆ AI INTELLIGENCE BRIEFING â€” CLASSIFIED: SECRET</div>
        <div class="modal-meta" id="modal-time">Powered by Claude Â· Generated at â€”</div>
      </div>
      <button id="modal-close" onclick="closeAI()">âœ•</button>
    </div>
    <div class="modal-body">
      <div id="ai-loading" class="loading-state">
        <div class="spinner">âŸ³</div>
        <div class="loading-text">Analyzing risk signals...</div>
        <div class="loading-sub" id="loading-sub">Cross-referencing energy dependency matrix</div>
      </div>
      <div id="ai-output" style="display:none"></div>
    </div>
  </div>
</div>

<script>
// ===================== DATA =====================
const SIGNALS_DATA = [
  {id:1,type:"SANCTION",sev:"CRITICAL",src:"USA",sector:"Shipping",msg:"OFAC advisory: India-flagged tankers carrying Russian crude face secondary sanctions risk effective Q2 2026.",trend:"up"},
  {id:2,type:"TARIFF",sev:"CRITICAL",src:"USA",sector:"Pharmaceuticals",msg:"US Section 301 review expanded to Indian generic drug exports. Proposed tariff: 25%. Impact: $3.6B.",trend:"up"},
  {id:3,type:"SANCTION",sev:"HIGH",src:"EU",sector:"Energy",msg:"EU secondary sanctions debate on Russia oil transit via Indian refineries gaining legislative traction.",trend:"up"},
  {id:4,type:"SUPPLY",sev:"HIGH",src:"RUSSIA",sector:"Crude Oil",msg:"Baltic Sea shipping corridor disruption. Ural crude delivery delays at Vadinar up 18 days.",trend:"stable"},
  {id:5,type:"TARIFF",sev:"HIGH",src:"USA",sector:"Textiles",msg:"US ITC investigation into Indian textile dumping. Section 201 safeguard tariff of 32% proposed.",trend:"up"},
  {id:6,type:"FTA",sev:"LOW",src:"EU",sector:"Textiles/Engineering",msg:"India-EU FTA implementation milestone: duty-free access confirmed for 99% of Indian export categories.",trend:"down"},
  {id:7,type:"TARIFF",sev:"MEDIUM",src:"USA",sector:"Gems & Jewellery",msg:"US Customs enhanced scrutiny on Indian diamond exports. Processing delays up 40%. $2.8B at risk.",trend:"stable"},
  {id:8,type:"SUPPLY",sev:"MEDIUM",src:"MIDDLE EAST",sector:"Crude Oil",msg:"UAE Murban crude spot availability improving. Viable Urals substitute at ~$4/bbl premium.",trend:"down"},
  {id:9,type:"SANCTION",sev:"LOW",src:"G7",sector:"Finance",msg:"G7 communiquÃ©: review of India's alternative payment rails (RuPay/SPFS) for Russia trade.",trend:"up"},
  {id:10,type:"FTA",sev:"LOW",src:"UK",sector:"Services",msg:"India-UK FTA services chapter breakthrough expected April 2026. IT sector duty-free access confirmed.",trend:"down"},
];

const LIVE_SIGNALS = [
  {type:"TARIFF",sev:"HIGH",src:"USA",sector:"Seafood",msg:"US FDA enhanced inspection protocol for Indian seafood. Rejection rate +15% MoM. $1.4B exposure."},
  {type:"SUPPLY",sev:"MEDIUM",src:"RUSSIA",sector:"Crude Oil",msg:"Rosneft confirms uninterrupted supply to Nayara Energy refinery through Q2 2026."},
  {type:"SANCTION",sev:"CRITICAL",src:"USA",sector:"Banking",msg:"OFAC expands SDN consideration to 3 Indian PSU banks with Russia energy payment exposure."},
  {type:"FTA",sev:"LOW",src:"ASEAN",sector:"Manufacturing",msg:"India-ASEAN trade review: electronics value chain integration MoU signed. $8B opportunity."},
  {type:"TARIFF",sev:"MEDIUM",src:"USA",sector:"IT Services",msg:"US proposes digital services tax review affecting Indian IT exports. $30B sector under watch."},
];

const PARTNERS = [
  {
    id:"us", flag:"ðŸ‡ºðŸ‡¸", name:"United States", cls:"partner-us",
    status:"STRAINED", trade:"$118B bilateral",
    note:"Punitive tariffs on $13.2B of Indian exports. Section 301 reviews expanding.",
    baseRating:38, dimensions:[
      {label:"Trade Stability",val:30,color:"#ef4444"},
      {label:"Tariff Threat",val:75,color:"#f97316"},
      {label:"Diplomatic Warmth",val:55,color:"#eab308"},
      {label:"Market Access",val:45,color:"#60a5fa"},
    ],
    tags:["HIGH TARIFF RISK","SECTION 301","TRADE WAR RISK"],
    tagColors:["#ef4444","#f97316","#f97316"],
    ratingColor:"#ef4444",
  },
  {
    id:"eu", flag:"ðŸ‡ªðŸ‡º", name:"European Union", cls:"partner-eu",
    status:"POSITIVE", trade:"â‚¬180B (FTA Active)",
    note:"Historic FTA finalised Jan 2026. Duty-free access for 99% Indian exports. Strategic counterbalance.",
    baseRating:82, dimensions:[
      {label:"Trade Stability",val:85,color:"#22c55e"},
      {label:"FTA Depth",val:92,color:"#22c55e"},
      {label:"Regulatory Alignment",val:68,color:"#eab308"},
      {label:"Market Access",val:88,color:"#22c55e"},
    ],
    tags:["FTA ACTIVE","DUTY-FREE","LOW RISK"],
    tagColors:["#22c55e","#22c55e","#22c55e"],
    ratingColor:"#22c55e",
  },
  {
    id:"ru", flag:"ðŸ‡·ðŸ‡º", name:"Russia", cls:"partner-ru",
    status:"CRITICAL DEPENDENCY", trade:"$68.7B bilateral",
    note:"38% crude oil dependency. Sanction spillover risk. Any disruption could destabilise fuel prices within 72h.",
    baseRating:24, dimensions:[
      {label:"Supply Reliability",val:60,color:"#eab308"},
      {label:"Sanction Exposure",val:85,color:"#ef4444"},
      {label:"Price Advantage",val:78,color:"#22c55e"},
      {label:"Geopolitical Risk",val:88,color:"#ef4444"},
    ],
    tags:["SANCTION RISK","ENERGY LOCK-IN","DIVERSIFY URGENT"],
    tagColors:["#ef4444","#f97316","#ef4444"],
    ratingColor:"#ef4444",
  },
  {
    id:"cn", flag:"ðŸ‡¨ðŸ‡³", name:"China", cls:"partner-cn",
    status:"COMPETITIVE THREAT", trade:"$117B deficit",
    note:"India's largest trade deficit partner. Dumping concerns in electronics, steel, chemicals.",
    baseRating:31, dimensions:[
      {label:"Trade Balance",val:12,color:"#ef4444"},
      {label:"Supply Chain Risk",val:65,color:"#f97316"},
      {label:"Import Competition",val:78,color:"#f97316"},
      {label:"Diplomatic Tension",val:55,color:"#eab308"},
    ],
    tags:["TRADE DEFICIT","IMPORT THREAT","BORDER TENSION"],
    tagColors:["#f97316","#f97316","#f97316"],
    ratingColor:"#f97316",
  },
];

const ENERGY_DATA = [
  {name:"Russia",pct:38,color:"#ef4444",risk:"CRITICAL"},
  {name:"Iraq",pct:22,color:"#f97316",risk:"MEDIUM"},
  {name:"Saudi Arabia",pct:16,color:"#eab308",risk:"LOW"},
  {name:"UAE",pct:10,color:"#22c55e",risk:"LOW"},
  {name:"USA",pct:4,color:"#60a5fa",risk:"LOW"},
  {name:"Others",pct:10,color:"#6b7280",risk:"LOW"},
];

const SECTORS = [
  {name:"Pharma",exposure:78,color:"#ef4444",risk:"HIGH"},
  {name:"Textiles",exposure:65,color:"#f97316",risk:"HIGH"},
  {name:"Gems",exposure:71,color:"#f97316",risk:"HIGH"},
  {name:"Seafood",exposure:55,color:"#eab308",risk:"MED"},
  {name:"Engineering",exposure:42,color:"#22c55e",risk:"MED"},
  {name:"IT Svcs",exposure:31,color:"#22c55e",risk:"LOW"},
];

const PREDICTIONS = [
  {type:"TARIFF",prob:72,text:"US expands Section 301 to Indian IT services sector ($30B exposure)",color:"#ef4444"},
  {type:"SUPPLY",prob:58,text:"Russia crude discount narrows below $5/bbl, raising import costs by ~$2.1B annually",color:"#f97316"},
  {type:"SANCTION",prob:45,text:"EU triggers human rights audit clause in FTA implementation review",color:"#eab308"},
  {type:"FTA",prob:38,text:"India-UK FTA services chapter finalised; IT sector duty-free access unlocked",color:"#22c55e"},
  {type:"TARIFF",prob:29,text:"G7 coordinated action on India's Russia oil trade payment mechanisms",color:"#22c55e"},
];

const EXPORTS = [
  {sector:"Textiles ($4.2B)",current:"USA",alt:"EU (FTA) + ASEAN",divert:65},
  {sector:"Pharma ($3.6B)",current:"USA",alt:"UK + Africa + LATAM",divert:50},
  {sector:"Gems ($2.8B)",current:"USA",alt:"Middle East + EU",divert:70},
  {sector:"Seafood ($1.4B)",current:"USA",alt:"Japan + SE Asia",divert:45},
];

const SAFEGUARDS = [
  {icon:"ðŸ’°",text:"PLI scheme top-up for pharma & textiles: â‚¹15,000 Cr",priority:"CRITICAL",tl:"Q1 2026"},
  {icon:"ðŸ¦",text:"EXIM Bank emergency credit line: $2B for export diversification",priority:"CRITICAL",tl:"30 days"},
  {icon:"âš¡",text:"Fast-track IEA membership to signal energy policy shift",priority:"HIGH",tl:"45 days"},
  {icon:"ðŸŒ",text:"Activate India-GCC FTA negotiations for energy diversification",priority:"HIGH",tl:"Q2 2026"},
  {icon:"ðŸ“Š",text:"Real-time tariff monitoring (GeoWatch system): operational",priority:"LOW",tl:"Active"},
];

// ===================== STATE =====================
let signals = [...SIGNALS_DATA].map((s,i)=>({...s,ts:new Date(Date.now()-i*180000),shown:true}));
let currentFilter = "ALL";
let partnerRatings = {};
PARTNERS.forEach(p=>{ partnerRatings[p.id] = p.baseRating; });
let signalIdCounter = 100;

// ===================== CLOCK =====================
function updateClock(){
  const now = new Date();
  document.getElementById("clock").textContent =
    now.toLocaleTimeString("en-IN",{hour12:false}) + " IST";
}
setInterval(updateClock,1000); updateClock();

// ===================== TICKER =====================
function buildTicker(){
  const items = signals.map(s=>`
    <span class="ticker-item">
      <span class="t-${s.sev.toLowerCase()}">[${s.sev}]</span>
      <span style="color:var(--accent)">${s.src}</span>
      <span style="color:var(--text-mid)">${s.sector}:</span>
      <span style="color:var(--text-dim)">${s.msg.substring(0,60)}...</span>
    </span>
  `).join("");
  const t = document.getElementById("ticker-track");
  t.innerHTML = items+items; // duplicate for seamless loop
}

// ===================== SIGNALS =====================
function timeAgo(d){
  const s=Math.floor((Date.now()-d)/1000);
  if(s<60) return s+"s ago";
  if(s<3600) return Math.floor(s/60)+"m ago";
  return Math.floor(s/3600)+"h ago";
}
function sevClass(s){return s.toLowerCase().replace("medium","med")}
function trendIcon(t){
  if(t==="up") return '<span class="trend-up">â–²</span>';
  if(t==="down") return '<span class="trend-dn">â–¼</span>';
  return '<span class="trend-neu">â€”</span>';
}

function renderSignals(){
  const feed = document.getElementById("signal-feed");
  const filtered = currentFilter==="ALL" ? signals : signals.filter(s=>s.sev===currentFilter);
  document.getElementById("signal-count").textContent = filtered.length+" signals";
  document.getElementById("kpi-signals").textContent = signals.length;
  const crits = signals.filter(s=>s.sev==="CRITICAL").length;
  document.getElementById("kpi-crit-count").textContent = crits+" CRITICAL";

  feed.innerHTML = filtered.map((s,i)=>`
    <div class="signal-card ${sevClass(s.sev)} ${i===0&&s._new?"new-signal":""}" id="sig-${s.id}">
      <div class="sig-meta">
        <span class="sig-type">${s.type}</span>
        <span style="color:var(--text-dim)">Â·</span>
        <span class="sig-source">${s.src}</span>
        <span style="color:var(--text-dim)">Â·</span>
        <span class="sig-sector">${s.sector}</span>
      </div>
      <div class="sig-text">${s.msg}</div>
      <div class="sig-footer">
        <div style="display:flex;gap:6px;align-items:center">
          <span class="badge ${sevClass(s.sev)}">${s.sev}</span>
          ${trendIcon(s.trend)}
        </div>
        <span class="sig-time">${timeAgo(s.ts)}</span>
      </div>
    </div>
  `).join("");

  updateNationalRisk();
  buildTicker();
}

function setFilter(f){
  currentFilter=f;
  document.querySelectorAll(".filter-btn").forEach(b=>{
    b.className = "filter-btn";
    if(b.dataset.filter===f) b.className += f==="ALL"?" active-all":" active-"+f;
  });
  renderSignals();
}

// ===================== NATIONAL RISK =====================
function updateNationalRisk(){
  const crits = signals.filter(s=>s.sev==="CRITICAL").length;
  const highs = signals.filter(s=>s.sev==="HIGH").length;
  let risk="MEDIUM", color=["#eab308","rgba(234,179,8,0.12)","rgba(234,179,8,0.3)"];
  if(crits>0){risk="CRITICAL";color=["#ef4444","rgba(239,68,68,0.15)","rgba(239,68,68,0.4)"]}
  else if(highs>2){risk="HIGH";color=["#f97316","rgba(249,115,22,0.12)","rgba(249,115,22,0.35)"]}
  else if(highs===0){risk="LOW";color=["#22c55e","rgba(34,197,94,0.12)","rgba(34,197,94,0.35)"]}
  const pill = document.getElementById("nat-risk-pill");
  pill.style.borderColor = color[0];
  pill.style.background = color[1];
  pill.style.boxShadow = `0 0 12px ${color[2]}`;
  document.getElementById("nat-risk-text").style.color = color[0];
  document.getElementById("nat-risk-text").textContent = "NATIONAL RISK: "+risk;
  // dot color
  const dotSpans = document.querySelectorAll("#nat-dot span");
  dotSpans.forEach(s=>s.style.background=color[0]);
}

// ===================== PARTNER RATINGS =====================
function getRatingLabel(r){
  if(r>=80) return {label:"STABLE",color:"#22c55e"};
  if(r>=60) return {label:"MODERATE",color:"#eab308"};
  if(r>=40) return {label:"STRAINED",color:"#f97316"};
  return {label:"CRITICAL",color:"#ef4444"};
}

function renderPartnerRatings(){
  const el = document.getElementById("partner-ratings");
  el.innerHTML = PARTNERS.map(p=>{
    const rating = partnerRatings[p.id];
    const rl = getRatingLabel(rating);
    return `
    <div class="partner-card ${p.cls}" id="pcard-${p.id}">
      <div class="partner-top">
        <div class="partner-name">
          <span class="partner-flag">${p.flag}</span>
          <div>
            <div class="partner-title">${p.name}</div>
            <div class="partner-subtitle">${p.trade}</div>
          </div>
        </div>
        <div class="partner-rating-box">
          <div class="rating-score" style="color:${p.ratingColor}" id="rating-${p.id}">${rating}</div>
          <div class="rating-label" style="color:${rl.color}" id="rlabel-${p.id}">${rl.label}</div>
          <div class="rating-change" id="rchange-${p.id}" style="color:var(--text-dim)">â€”</div>
        </div>
      </div>
      ${p.dimensions.map(d=>`
        <div class="partner-bar-wrap">
          <div class="partner-bar-label">
            <span class="bar-lbl">${d.label}</span>
            <span class="bar-lbl" style="color:${d.color}">${d.val}%</span>
          </div>
          <div class="bar-track">
            <div class="bar-fill" style="width:${d.val}%;background:${d.color};box-shadow:0 0 6px ${d.color}66"></div>
          </div>
        </div>
      `).join("")}
      <div class="partner-tags">
        ${p.tags.map((t,i)=>`<span class="ptag" style="border-color:${p.tagColors[i]};color:${p.tagColors[i]}">${t}</span>`).join("")}
      </div>
      <div class="partner-note">${p.note}</div>
    </div>
  `}).join("");
}

function updatePartnerRatings(){
  PARTNERS.forEach(p=>{
    const prev = partnerRatings[p.id];
    // Simulate live fluctuation: small random drift Â± 3 within Â±8 of base
    const drift = (Math.random()-0.5)*4;
    const newRating = Math.max(10, Math.min(99, Math.round(prev + drift)));
    partnerRatings[p.id] = newRating;

    const scoreEl = document.getElementById("rating-"+p.id);
    const labelEl = document.getElementById("rlabel-"+p.id);
    const changeEl = document.getElementById("rchange-"+p.id);
    const card = document.getElementById("pcard-"+p.id);

    if(scoreEl){
      scoreEl.textContent = newRating;
      scoreEl.style.animation="none"; void scoreEl.offsetWidth;
      scoreEl.style.animation="countUp .4s ease";

      const rl = getRatingLabel(newRating);
      labelEl.textContent = rl.label;
      labelEl.style.color = rl.color;

      const delta = newRating - prev;
      changeEl.textContent = (delta>=0?"â–² +":"â–¼ ")+delta;
      changeEl.style.color = delta>=0?"#ef4444":"#22c55e";
      changeEl.style.animation="none"; void changeEl.offsetWidth;
      changeEl.style.animation="countUp .4s ease";

      if(Math.abs(delta)>=2){
        card.classList.add("live-update-flash");
        setTimeout(()=>card.classList.remove("live-update-flash"),600);
      }
    }
  });
}

// ===================== ENERGY BARS =====================
function renderEnergyBars(){
  const el = document.getElementById("energy-bars");
  el.innerHTML = ENERGY_DATA.map(d=>`
    <div class="energy-row">
      <div class="energy-top">
        <span class="energy-name">${d.name}</span>
        <span class="energy-pct" style="color:${d.color}">${d.pct}%
          <span style="font-size:9px;margin-left:4px;" class="badge ${d.risk.toLowerCase()}">${d.risk}</span>
        </span>
      </div>
      <div class="energy-track">
        <div class="energy-fill" style="width:${d.pct}%;background:${d.color};box-shadow:0 0 8px ${d.color}66">
          <div style="position:absolute;right:0;top:0;bottom:0;width:4px;background:${d.color};filter:blur(4px)"></div>
        </div>
      </div>
    </div>
  `).join("");
}

// ===================== SECTOR GRID =====================
function renderSectorGrid(){
  const el = document.getElementById("sector-grid");
  const r = 22; const circ = 2*Math.PI*r;
  el.innerHTML = SECTORS.map(s=>{
    const offset = circ*(1-s.exposure/100);
    return `
    <div class="sector-card">
      <div class="sector-name">${s.name}</div>
      <div class="sector-ring">
        <svg class="ring-svg" width="54" height="54" viewBox="0 0 54 54">
          <circle class="ring-bg" cx="27" cy="27" r="${r}"/>
          <circle class="ring-fill" cx="27" cy="27" r="${r}"
            stroke="${s.color}"
            stroke-dasharray="${circ}"
            stroke-dashoffset="${offset}"/>
        </svg>
        <div class="ring-val" style="color:${s.color}">${s.exposure}%</div>
      </div>
      <div class="sector-risk" style="color:${s.color}">${s.risk} RISK</div>
    </div>
  `}).join("");
}

// ===================== PREDICTIONS =====================
function renderPredictions(){
  const el = document.getElementById("predictions");
  el.innerHTML = PREDICTIONS.map(p=>`
    <div class="pred-card">
      <div class="pred-top">
        <span class="pred-type">${p.type}</span>
        <span class="pred-prob" style="color:${p.color}">${p.prob}%</span>
      </div>
      <div class="pred-text">${p.text}</div>
      <div class="pred-bar-track">
        <div class="pred-bar-fill" style="width:${p.prob}%;background:${p.color}"></div>
      </div>
    </div>
  `).join("");
}

// ===================== EXPORT MAP =====================
function renderExportMap(){
  const el = document.getElementById("export-map");
  el.innerHTML = EXPORTS.map(e=>`
    <div style="padding:8px 0;border-bottom:1px solid var(--border)">
      <div style="display:flex;justify-content:space-between;margin-bottom:4px">
        <span style="font-size:11px;color:var(--text)">${e.sector}</span>
        <span style="font-family:var(--font-mono);font-size:9px;color:var(--low)">${e.divert}% divertible</span>
      </div>
      <div style="font-family:var(--font-mono);font-size:9px;color:var(--text-dim)">
        <span style="color:var(--high)">NOW: ${e.current}</span>
        <span style="margin:0 6px">â†’</span>
        <span style="color:var(--low)">ALT: ${e.alt}</span>
      </div>
      <div class="pred-bar-track" style="margin-top:5px">
        <div class="pred-bar-fill" style="width:${e.divert}%;background:var(--low)"></div>
      </div>
    </div>
  `).join("");
}

// ===================== SAFEGUARDS =====================
function renderSafeguards(){
  const el = document.getElementById("safeguards");
  const cls={CRITICAL:"crit",HIGH:"high",MEDIUM:"med",LOW:"low"};
  el.innerHTML = SAFEGUARDS.map(s=>`
    <div style="display:flex;gap:8px;align-items:flex-start;padding:8px 0;border-bottom:1px solid var(--border)">
      <span style="font-size:16px;flex-shrink:0">${s.icon}</span>
      <div style="flex:1">
        <div style="font-size:11px;color:var(--text);line-height:1.4">${s.text}</div>
        <div style="font-family:var(--font-mono);font-size:8px;color:var(--text-dim);margin-top:3px">TL: ${s.tl}</div>
      </div>
      <span class="badge ${cls[s.priority]||"low"}">${s.priority}</span>
    </div>
  `).join("");
}

// ===================== LIVE SIGNAL INJECTION =====================
function injectLiveSignal(){
  const tmpl = LIVE_SIGNALS[Math.floor(Math.random()*LIVE_SIGNALS.length)];
  const newSig = {...tmpl, id:++signalIdCounter, ts:new Date(), _new:true, trend:"up"};
  signals.unshift(newSig);
  if(signals.length>30) signals.pop();

  // show toast
  const colors={CRITICAL:"#ef4444",HIGH:"#f97316",MEDIUM:"#eab308",LOW:"#22c55e"};
  const toastEl = document.getElementById("toast");
  const toastInner = document.getElementById("toast-inner");
  const color = colors[newSig.sev]||"#64748b";
  toastInner.style.borderColor = color;
  toastInner.style.boxShadow = `0 0 20px ${color}44`;
  document.getElementById("toast-label").textContent = `LIVE SIGNAL â€” ${newSig.sev}`;
  document.getElementById("toast-label").style.color = color;
  document.getElementById("toast-text").textContent = newSig.msg;
  const dotSpans = toastEl.querySelectorAll(".live-dot-wrap span");
  dotSpans.forEach(s=>s.style.background=color);

  toastEl.classList.add("show");
  toastEl.style.animation="none"; void toastEl.offsetWidth;
  toastEl.style.animation="slideInRight .4s ease";
  setTimeout(()=>toastEl.classList.remove("show"),5000);

  renderSignals();

  // also slightly update energy bar for russia randomly
  if(Math.random()>0.6){
    const russiaData = ENERGY_DATA.find(e=>e.name==="Russia");
    if(russiaData) russiaData.pct = Math.max(34,Math.min(42,russiaData.pct+(Math.random()>.5?1:-1)));
    renderEnergyBars();
  }
}

// ===================== AI MODAL =====================
function openAI(){
  document.getElementById("ai-modal").classList.add("open");
  document.getElementById("ai-output").style.display="none";
  document.getElementById("ai-loading").style.display="block";
  document.getElementById("modal-time").textContent =
    "Powered by Claude Â· Generated at "+new Date().toLocaleTimeString("en-IN",{hour12:false})+" IST";
  const sub = document.getElementById("loading-sub");
  const msgs=["Cross-referencing energy dependency matrix...","Analyzing partner risk ratings...","Processing "+signals.length+" live signals...","Generating strategic recommendations..."];
  let mi=0; const iv=setInterval(()=>{ sub.textContent=msgs[mi%msgs.length]; mi++; },1200);

  const sigSummary = signals.slice(0,8).map(s=>`[${s.type}/${s.sev}] ${s.src} â€” ${s.sector}: ${s.msg}`).join("\n");
  const partnerSummary = PARTNERS.map(p=>`${p.name}: ${p.status}, Rating ${partnerRatings[p.id]}/100`).join("; ");

  fetch("https://api.anthropic.com/v1/messages",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      model:"claude-sonnet-4-20250514",
      max_tokens:1000,
      system:`You are a senior geopolitical trade analyst for the Government of India's Ministry of Commerce and Industry. 
Produce a classified intelligence briefing in exactly this structure:

THREAT ASSESSMENT
[2-3 sentences analysing the most critical active threats]

IMMEDIATE RECOMMENDATIONS (Next 30 Days)
â€¢ [Action 1]
â€¢ [Action 2]  
â€¢ [Action 3]
â€¢ [Action 4]

PREDICTIVE OUTLOOK
[2-3 sentences on 30-90 day scenario]

STRATEGIC MULTI-ALIGNMENT ADVISORY
[1-2 sentences on balancing US/EU/Russia without over-dependency]

Use government intelligence briefing style. Be specific, data-driven, and actionable. Reference actual figures from the context.`,
      messages:[{
        role:"user",
        content:`Analyze these LIVE geopolitical risk signals for India:\n\n${sigSummary}\n\nPARTNER STATUS: ${partnerSummary}\n\nCONTEXT: India imports 38% crude from Russia ($63.84B), merchandise deficit $34.68B (Jan 2026), US tariffs on $13.2B of Indian exports, India-EU FTA active covering â‚¬180B in trade, India-Russia bilateral at $68.7B.`
      }]
    })
  })
  .then(r=>r.json())
  .then(data=>{
    clearInterval(iv);
    const text = data.content?.[0]?.text || "No analysis returned.";
    document.getElementById("ai-loading").style.display="none";
    const out = document.getElementById("ai-output");
    out.style.display="block";
    // Typing effect
    out.textContent="";
    let i=0;
    const typer=setInterval(()=>{
      out.textContent+=text[i]; i++;
      if(i>=text.length) clearInterval(typer);
    },12);
  })
  .catch(e=>{
    clearInterval(iv);
    document.getElementById("ai-loading").style.display="none";
    const out = document.getElementById("ai-output");
    out.style.display="block";
    out.style.color="#ef4444";
    out.textContent="âš  CONNECTION ERROR\n\nFailed to reach AI analysis engine.\n\nPlease check your network connection and API access.";
  });
}

function closeAI(){
  document.getElementById("ai-modal").classList.remove("open");
}

document.getElementById("ai-btn").addEventListener("click",openAI);
document.getElementById("ai-modal").addEventListener("click",function(e){
  if(e.target===this) closeAI();
});

// ===================== INIT & INTERVALS =====================
renderSignals();
renderPartnerRatings();
renderEnergyBars();
renderSectorGrid();
renderPredictions();
renderExportMap();
renderSafeguards();

// Update timestamps every 30s
setInterval(()=>{
  document.querySelectorAll(".sig-time").forEach((el,i)=>{
    if(signals[i]) el.textContent=timeAgo(signals[i].ts);
  });
},30000);

// Live signal every 18s
setInterval(injectLiveSignal, 18000);

// Partner ratings update every 8s
setInterval(updatePartnerRatings, 8000);

// Update predictions probabilities slightly every 15s
setInterval(()=>{
  PREDICTIONS.forEach(p=>{
    p.prob = Math.max(5,Math.min(95,p.prob+Math.round((Math.random()-.5)*4)));
  });
  renderPredictions();
}, 15000);
</script>
</body>
</html>
